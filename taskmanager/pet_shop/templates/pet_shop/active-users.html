{% extends 'pet_shop/base.html' %}

{% block title %}
Активні користувачі
{% endblock %}

{% block body %}
<div class="container">
    <h1>Активні користувачі</h1>
    <table id="active-users-table" class="table">
        <thead>
            <tr>
                <th>Name</th>
                <th>Email</th>
                <th>Channel name</th>
            </tr>
        </thead>
        <tbody id="active-users-body">
        </tbody>
    </table>
    <table id="tasks-table" class="table">
        <thead>
            <tr>
                <th>Сповіщення</th>
            </tr>
        </thead>
        <tbody id="tasks-table-body">
        </tbody>
    </table>
</div>
<div class="col-4">
     <p id="log"></p>
</div>
    <script>
        const socket = new WebSocket(
            'ws://'
            + window.location.host
            + '/ws/notification/'
        );

        socket.onmessage = function(event) {
            const data = JSON.parse(event.data);
            if (data.type === 'active_users') {
                const users = data.users;
                const tbody = document.getElementById('active-users-body');
                tbody.innerHTML = '';

                users.forEach(user => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${user.name}</td>
                        <td>${user.email}</td>
                        <td>${user.channel_name}</td>
                    `;
                    tbody.appendChild(row);
                });
            }
            console.log(data.message);
            if (data.tag === 'task_message') {
                const table = document.getElementById('tasks-table-body');
                const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${data.message}</td>
                    `;
                table.appendChild(row);
            }
        };
    </script>
{% endblock %}
